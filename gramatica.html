

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gramática</title>
    <!-- Tailwind CSS para estilos rápidos y modernos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React y ReactDOM para la funcionalidad de la aplicación -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel para compilar JSX directamente en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Estilos y animaciones personalizadas */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, 
                #8B4513 0%, #CD853F 15%, #DC143C 35%, 
                #FFD700 50%, #FF8C00 65%, #228B22 85%, #8B4513 100%
            );
            background-image: url('2html.jpg');
            background-size: 100% 100%;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: scroll;
            min-height: 100vh;
            color: white;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            z-index: 0;
        }
        
        #root {
            position: relative;
            z-index: 1;
        }
        
        /* Efecto de hojas cayendo */
        .falling-leaves {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .leaf {
            position: absolute;
            opacity: 0.2;
            font-size: 1.5em;
            animation: fall linear infinite;
        }
        
        .leaf:nth-child(odd) {
            color: #DC143C;
            animation-duration: 8s;
        }
        
        .leaf:nth-child(even) {
            color: #FF8C00;
            animation-duration: 12s;
        }
        
        .leaf:nth-child(3n) {
            color: #FFA500;
            animation-duration: 10s;
        }
        
        .leaf:nth-child(4n) {
            color: #B22222;
            animation-duration: 15s;
        }
        
        @keyframes fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 0.3;
            }
            10% {
                opacity: 0.2;
            }
            90% {
                opacity: 0.1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            body {
                background-attachment: scroll;
                -webkit-overflow-scrolling: touch;
                background-size: cover !important;
            }
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        /* Definición de animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.8); }
            80% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
        @keyframes pulseOnce {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Clases para usar las animaciones */
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        .animate-pop-in {
            animation: popIn 0.3s ease-out forwards;
        }
        .animate-pulse-once {
            animation: pulseOnce 0.6s ease-in-out;
        }

        /* Glass morphism styles - Autumn theme */
        .glass-card {
            background: linear-gradient(135deg, 
                rgba(220, 20, 60, 0.15) 0%, 
                rgba(255, 140, 0, 0.12) 30%,
                rgba(255, 165, 0, 0.15) 60%,
                rgba(178, 34, 34, 0.12) 100%);
            border-radius: 20px;
            backdrop-filter: blur(15px) saturate(120%);
            box-shadow: 
                0 15px 50px rgba(220, 20, 60, 0.2),
                0 10px 30px rgba(255, 140, 0, 0.15);
            border: 2px solid rgba(255, 140, 0, 0.3);
            position: relative;
            z-index: 2;
        }

        .glass-header {
            background: linear-gradient(135deg, 
                rgba(220, 20, 60, 0.12) 0%, 
                rgba(255, 140, 0, 0.10) 30%,
                rgba(255, 165, 0, 0.12) 60%,
                rgba(178, 34, 34, 0.10) 100%);
            border-radius: 20px;
            backdrop-filter: blur(15px) saturate(120%);
            box-shadow: 
                0 12px 40px rgba(220, 20, 60, 0.15),
                0 8px 25px rgba(255, 140, 0, 0.12);
            border: 2px solid rgba(255, 140, 0, 0.25);
            position: relative;
            z-index: 2;
        }
    </style>
</head>
<body>
    <!-- Efecto de hojas cayendo -->
    <div class="falling-leaves" id="falling-leaves"></div>
    <div id="root"></div>

    <script type="text/babel">
        // --- CONSTANTES (FUERA DEL COMPONENTE) ---
        const grammarCodes = {
            1: "Verbo (Base)", 2: "Verbo (3ª Pers.)", 3: "Verbo (Pasado)", 4: "Gerundio", 5: "Participio", 6: "Modal", 10: "Nombre (Sing.)", 11: "Nombre (Pl.)", 12: "N. Propio", 20: "Pronombre Suj.", 21: "Pronombre Obj.", 24: "P. Interrogativo", 25: "P. Indefinido", 30: "Artículo Def.", 31: "Artículo Indef.", 32: "Demostrativo", 33: "Posesivo", 34: "Cuantificador", 40: "Adjetivo", 41: "Adj. Comparativo", 42: "Adj. Superlativo", 50: "Adverbio", 53: "Adv. Interrogativo", 60: "Preposición", 61: "Conjunción Coord.", 62: "Conjunción Sub.", 64: "Interjección", 65: "Posesivo ('s)", 66: "Existencial (There)", 67: "Sugerencia (Let's)", 68: "Infinitivo (to)"
        };

        const lexicon = {
            "i": { type: 20 }, "you": { type: 20 }, "he": { type: 20 }, "she": { type: 20 }, "it": { type: 20 }, "we": { type: 20 }, "they": { type: 20 }, "me": { type: 21 }, "him": { type: 21 }, "her": { type: 21 }, "us": { type: 21 }, "them": { type: 21 }, "my": { type: 33 }, "your": { type: 33 }, "his": { type: 33 }, "their": { type: 33 }, "a": { type: 31 }, "an": { type: 31 }, "the": { type: 30 }, "this": { type: 32 }, "that": { type: 32 }, "these": { type: 32 }, "those": { type: 32 }, "book": { type: 10 }, "dog": { type: 10 }, "car": { type: 10 }, "house": { type: 10 }, "teacher": { type: 10 }, "student": { type: 10 }, "books": { type: 11 }, "dogs": { type: 11 }, "cars": { type: 11 }, "houses": { type: 11 }, "teachers": { type: 11 }, "students": { type: 11 }, "john": { type: 12 }, "london": { type: 12 }, "mary": { type: 12 }, "read": { type: 1 }, "go": { type: 1 }, "play": { type: 1 }, "study": { type: 1 }, "reads": { type: 2 }, "goes": { type: 2 }, "plays": { type: 2 }, "studies": { type: 2 }, "reading": { type: 4 }, "going": { type: 4 }, "playing": { type: 4 }, "studying": { type: 4 }, "went": { type: 3 }, "played": { type: 3 }, "studied": { type: 3 }, "can": { type: 6 }, "will": { type: 6 }, "would": { type: 6 }, "could": { type: 6 }, "should": { type: 6 }, "may": { type: 6 }, "must": { type: 6 }, "big": { type: 40 }, "small": { type: 40 }, "happy": { type: 40 }, "sad": { type: 40 }, "new": { type: 40 }, "old": { type: 40 }, "in": { type: 60 }, "on": { type: 60 }, "at": { type: 60 }, "to": { type: 68 }, "from": { type: 60 }, "with": { type: 60 }, "for": { type: 60 }, "and": { type: 61 }, "but": { type: 61 }, "or": { type: 61 }, "so": { type: 61 }, "because": { type: 62 }, "when": { type: 62 }, "if": { type: 62 }, "although": { type: 62 }, "while": { type: 62 }, "where": { type: 53 }, "why": { type: 53 }, "how": { type: 53 }, "quickly": { type: 50 }, "slowly": { type: 50 }, "well": { type: 50 }, "badly": { type: 50 }, "very": { type: 50 }, "really": { type: 50 }, "always": { type: 50 }, "never": { type: 50 }, "some": { type: 34 }, "any": { type: 34 }, "many": { type: 34 }, "much": { type: 34 }, "few": { type: 34 }, "little": { type: 34 }, "there": { type: 66 }, "let's": { type: 67 }, "wow": { type: 64 }, "oh": { type: 64 }, "hey": { type: 64 }, "'s": { type: 65 }
        };

        // --- COMPONENTES HIJOS (UI) ---
        const InputScreen = ({ grammarTitle, examplesText, onInputChange, processExamples }) => (
          <div className="glass-card p-6 animate-fade-in">
            <h2 className="text-2xl font-bold mb-4" style={{color: '#FFD700'}}>Título</h2>
            <div className="space-y-4">
                <div>
                    <label htmlFor="grammarTitle" className="block font-semibold mb-2" style={{color: '#E0E0E0'}}></label>
                    <input id="grammarTitle" name="grammarTitle" type="text" value={grammarTitle} onChange={onInputChange} className="w-full rounded-md p-3" style={{
                        background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.1) 100%)',
                        backdropFilter: 'blur(15px) saturate(120%)',
                        border: '2px solid rgba(255, 140, 0, 0.4)',
                        color: 'white',
                        boxShadow: '0 8px 25px rgba(220, 20, 60, 0.15), 0 4px 15px rgba(255, 140, 0, 0.12)',
                        transition: 'all 0.3s ease'
                    }} placeholder="Ej: Presente Simple"/>
                </div>
                <div>
                    <label htmlFor="examplesText" className="block font-semibold mb-2" style={{color: '#E0E0E0'}}>Insertar frases:</label>
                    <textarea id="examplesText" name="examplesText" value={examplesText} onChange={onInputChange} className="w-full rounded-md p-3 h-80" style={{
                        background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.1) 100%)',
                        backdropFilter: 'blur(15px) saturate(120%)',
                        border: '2px solid rgba(255, 140, 0, 0.4)',
                        color: 'white',
                        boxShadow: '0 8px 25px rgba(220, 20, 60, 0.15), 0 4px 15px rgba(255, 140, 0, 0.12)',
                        transition: 'all 0.3s ease'
                    }} placeholder="Ej:&#10;She always drinks coffee.&#10;I never eat meat.&#10;They sometimes play tennis."/>
                </div>
            </div>
            <div className="flex justify-start mt-6">
                <button onClick={processExamples} className="text-white font-bold py-3 px-8 rounded-full shadow-md hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300" style={{
                    background: 'linear-gradient(45deg, rgba(220, 20, 60, 0.9), rgba(255, 140, 0, 0.9), rgba(255, 165, 0, 0.9))', 
                    border: 'none', 
                    cursor: 'pointer'
                }}>
                    Inicio
                </button>
            </div>
          </div>
        );

        const PracticeScreen = ({ practiceData, handlers }) => {
            const { grammarTitle, currentExampleIndex, examplesLength, grammarPattern, userAnswer, availableWords, feedback, slotStatus } = practiceData;
            const { handleDragStart, handleDragOver, handleDrop, removeFromSlot, handleTouchStart, handleTouchMove, handleTouchEnd, resetCurrentExercise, backToInput, checkAnswer, nextExample } = handlers;
            
            const getSlotClass = (index) => {
                switch(slotStatus[index]) {
                    case 'correct': return '';
                    case 'incorrect': return '';
                    default: return '';
                }
            };

            const getSlotStyle = (index) => {
                const baseStyle = {
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.05) 100%)',
                    backdropFilter: 'blur(10px)',
                    border: '2px dashed rgba(255, 140, 0, 0.3)',
                    transition: 'all 0.3s ease'
                };
                
                switch(slotStatus[index]) {
                    case 'correct': 
                        return {
                            ...baseStyle,
                            background: 'linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(34, 197, 94, 0.1) 100%)',
                            border: '2px dashed rgba(34, 197, 94, 0.4)',
                            boxShadow: '0 4px 15px rgba(34, 197, 94, 0.2)'
                        };
                    case 'incorrect': 
                        return {
                            ...baseStyle,
                            background: 'linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.1) 100%)',
                            border: '2px dashed rgba(239, 68, 68, 0.4)',
                            boxShadow: '0 4px 15px rgba(239, 68, 68, 0.2)'
                        };
                    default: 
                        return baseStyle;
                }
            };

            return (
                <div className="glass-card p-6 space-y-6 animate-fade-in">
                    <div className="flex justify-between items-center border-b pb-4">
                        <h2 className="text-xl font-bold" style={{color: '#FFD700'}}>{grammarTitle}</h2>
                        <div className="font-semibold" style={{color: '#E0E0E0'}}>Ejemplo {currentExampleIndex + 1} de {examplesLength}</div>
                    </div>
                    

                    <h3 className="font-semibold" style={{color: '#E0E0E0'}}>Reconstruir la frase::</h3>
                    
                    <div className="flex flex-wrap gap-3 min-h-[60px] p-2 rounded-lg border" style={{
                        background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.1) 100%)',
                        backdropFilter: 'blur(15px) saturate(120%)',
                        border: '2px solid rgba(255, 140, 0, 0.4)',
                        boxShadow: '0 8px 25px rgba(220, 20, 60, 0.15), 0 4px 15px rgba(255, 140, 0, 0.12)'
                    }}>
                        {userAnswer.map((word, index) => (
                            <div
                                key={index}
                                className="rounded-md p-2 min-w-[90px] h-14 flex items-center justify-center"
                                style={getSlotStyle(index)}
                                onDragOver={(e) => handleDragOver(e, index)}
                                onDrop={(e) => handleDrop(e, index)}
                                data-slot-index={index}
                            >
                                {word && (
                                    <div className="px-3 py-1 rounded-md flex items-center shadow-md animate-pop-in" style={{
                                        background: 'linear-gradient(135deg, #a7f3d0 0%, #86efac 50%, #6ee7b7 100%)',
                                        color: '#065f46',
                                        boxShadow: '0 4px 15px rgba(167, 243, 208, 0.3)'
                                    }}>
                                        <span>{word.text}</span>
                                        <button onClick={() => removeFromSlot(index)} className="ml-2 hover:text-red-600 font-bold text-lg" style={{
                                            color: '#047857',
                                            transition: 'color 0.2s ease'
                                        }}>×</button>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                    
                    <div className="flex flex-wrap gap-2 min-h-[50px] p-3 rounded-lg" style={{
                        background: 'linear-gradient(135deg, rgba(167, 243, 208, 0.15) 0%, rgba(134, 239, 172, 0.12) 50%, rgba(110, 231, 183, 0.15) 100%)',
                        backdropFilter: 'blur(15px) saturate(120%)',
                        border: '2px solid rgba(167, 243, 208, 0.4)',
                        boxShadow: '0 8px 25px rgba(167, 243, 208, 0.2), 0 4px 15px rgba(134, 239, 172, 0.15)'
                    }}>
                        {availableWords.map((word, index) => (
                            <div
                                key={`${word.text}-${index}`}
                                className="px-4 py-2 rounded-lg cursor-move shadow-sm hover:shadow-md transform hover:-translate-y-0.5 transition-all select-none"
                                style={{
                                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.15) 100%)',
                                    backdropFilter: 'blur(10px)',
                                    border: '1px solid rgba(255, 140, 0, 0.3)',
                                    color: 'white',
                                    boxShadow: '0 4px 15px rgba(220, 20, 60, 0.1)'
                                }}
                                onMouseEnter={(e) => {
                                    e.target.style.background = 'linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.25) 100%)';
                                    e.target.style.boxShadow = '0 6px 20px rgba(255, 140, 0, 0.2)';
                                }}
                                onMouseLeave={(e) => {
                                    e.target.style.background = 'linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.15) 100%)';
                                    e.target.style.boxShadow = '0 4px 15px rgba(220, 20, 60, 0.1)';
                                }}
                                draggable
                                onDragStart={(e) => handleDragStart(e, word, index)}
                                onTouchStart={(e) => handleTouchStart(e, word, index)}
                                onTouchMove={(e) => handleTouchMove(e)}
                                onTouchEnd={(e) => handleTouchEnd(e)}
                                style={{ touchAction: 'none' }}
                            >
                                {word.text}
                            </div>
                        ))}
                    </div>

                    {feedback && (
                        <div className="p-4 rounded-md text-center font-semibold animate-fade-in" style={
                            feedback.correct ? {
                                background: 'linear-gradient(135deg, rgba(167, 243, 208, 0.2) 0%, rgba(134, 239, 172, 0.15) 50%, rgba(110, 231, 183, 0.2) 100%)',
                                backdropFilter: 'blur(15px) saturate(120%)',
                                border: '2px solid rgba(167, 243, 208, 0.5)',
                                boxShadow: '0 8px 25px rgba(167, 243, 208, 0.25), 0 4px 15px rgba(134, 239, 172, 0.2)',
                                color: '#ffffff',
                                textShadow: '0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.6), 0 0 30px rgba(255, 255, 255, 0.4)'
                            } : {
                                background: 'linear-gradient(135deg, rgba(248, 113, 113, 0.2) 0%, rgba(239, 68, 68, 0.15) 50%, rgba(220, 38, 38, 0.2) 100%)',
                                backdropFilter: 'blur(15px) saturate(120%)',
                                border: '2px solid rgba(248, 113, 113, 0.5)',
                                boxShadow: '0 8px 25px rgba(248, 113, 113, 0.25), 0 4px 15px rgba(239, 68, 68, 0.2)',
                                color: '#ffffff',
                                textShadow: '0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.6), 0 0 30px rgba(255, 255, 255, 0.4)'
                            }
                        }>
                            {feedback.message}
                        </div>
                    )}

                    <div className="flex justify-between items-center pt-4 border-t">
                        <div>
                            <button onClick={resetCurrentExercise} className="text-white font-bold py-3 px-8 rounded-full shadow-md hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300 mr-2" style={{background: 'linear-gradient(45deg, rgba(220, 20, 60, 0.9), rgba(255, 140, 0, 0.9), rgba(255, 165, 0, 0.9))', border: 'none', cursor: 'pointer'}}>Reiniciar</button>
                            <button onClick={backToInput} className="text-white font-bold py-3 px-8 rounded-full shadow-md hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300" style={{background: 'linear-gradient(45deg, rgba(220, 20, 60, 0.9), rgba(255, 140, 0, 0.9), rgba(255, 165, 0, 0.9))', border: 'none', cursor: 'pointer'}}>Volver</button>
                        </div>
                        <div>
                            {feedback && feedback.correct ? (
                                <button onClick={nextExample} className="text-white font-bold py-3 px-8 rounded-full shadow-md hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300 animate-pulse-once" style={{background: 'linear-gradient(45deg, rgba(220, 20, 60, 0.9), rgba(255, 140, 0, 0.9), rgba(255, 165, 0, 0.9))', border: 'none', cursor: 'pointer'}}>Siguiente →</button>
                            ) : (
                                <button onClick={checkAnswer} disabled={feedback !== null} className="text-white font-bold py-3 px-8 rounded-full shadow-md hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none" style={{background: feedback !== null ? '#888' : 'linear-gradient(45deg, rgba(220, 20, 60, 0.9), rgba(255, 140, 0, 0.9), rgba(255, 165, 0, 0.9))', border: 'none', cursor: feedback !== null ? 'not-allowed' : 'pointer'}}>Verificar</button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const ResultsScreen = ({ resultsData, handlers }) => {
            const { grammarTitle, correctAnswers, examples } = resultsData;
            const { resetEverything, startPractice } = handlers;
            const total = examples.length;
            const percentage = total > 0 ? Math.round((correctAnswers / total) * 100) : 0;
            
            return (
                <div className="glass-card p-6 text-center animate-fade-in">
                    <h2 className="text-2xl font-bold mb-4" style={{color: '#FFD700'}}>Resultados de la Práctica</h2>
                    <div className="p-6 rounded-lg mb-6" style={{background: 'rgba(255, 215, 0, 0.1)', border: '1px solid rgba(255, 215, 0, 0.2)'}}>
                        <p className="text-xl mb-2" style={{color: '#E0E0E0'}}>Completaste el ejercicio de <span className="font-bold" style={{color: '#FFD700'}}>{grammarTitle}</span></p>
                        <p className="text-5xl font-bold my-4" style={{color: '#FFD700'}}>{percentage}%</p>
                        <p style={{color: '#B0B0B0'}}>({correctAnswers} de {total} correctos)</p>
                    </div>
                    <div className="flex justify-center gap-4">
                        <button onClick={resetEverything} className="text-white font-bold py-3 px-8 rounded-full shadow-md hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300" style={{background: 'linear-gradient(45deg, rgba(220, 20, 60, 0.9), rgba(255, 140, 0, 0.9), rgba(255, 165, 0, 0.9))', border: 'none', cursor: 'pointer'}}>Volver al Inicio</button>
                        <button onClick={() => startPractice(examples)} className="text-white font-bold py-3 px-8 rounded-full shadow-md hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300" style={{background: 'linear-gradient(45deg, rgba(220, 20, 60, 0.9), rgba(255, 140, 0, 0.9), rgba(255, 165, 0, 0.9))', border: 'none', cursor: 'pointer'}}>Practicar de Nuevo</button>
                    </div>
                </div>
            );
        };

        // --- COMPONENTE PRINCIPAL (Contiene toda la lógica) ---
        const App = () => {
            // Corrección: Usar React.useState en lugar de useState
            const [appState, setAppState] = React.useState('input'); // 'input', 'practice', 'results'
            const [formState, setFormState] = React.useState({
                grammarTitle: '',
                examplesText: ''
            });
            const [examples, setExamples] = React.useState([]);
            const [grammarPattern, setGrammarPattern] = React.useState([]);
            
            const [currentExampleIndex, setCurrentExampleIndex] = React.useState(0);
            const [availableWords, setAvailableWords] = React.useState([]);
            const [userAnswer, setUserAnswer] = React.useState([]);
            const [slotStatus, setSlotStatus] = React.useState([]);
            
            const [feedback, setFeedback] = React.useState(null);
            const [correctAnswers, setCorrectAnswers] = React.useState(0);
            
            const [draggingItem, setDraggingItem] = React.useState(null);
            const [touchState, setTouchState] = React.useState({
                isDragging: false,
                draggedElement: null,
                startPosition: { x: 0, y: 0 },
                currentPosition: { x: 0, y: 0 }
            });

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormState(prev => ({ ...prev, [name]: value }));
            };

            const processExamples = () => {
                if (!formState.examplesText.trim()) {
                    alert('Por favor, ingresa al menos un ejemplo.');
                    return;
                }
                const lines = formState.examplesText.split('\n').map(l => l.trim()).filter(Boolean);
                
                const processed = lines.map(line => {
                    const originalWords = line.split(' ');
                    const wordObjects = originalWords.map(text => ({
                        text: text,
                        normalized: text.toLowerCase().replace(/[.,!?;:'"()]/g, '')
                    }));
                    const pattern = wordObjects.map(w => lexicon[w.normalized]?.type || null);
                    if (pattern.includes(null)) {
                        console.warn(`La oración "${line}" contiene palabras no encontradas en el léxico.`);
                    }
                    return { original: line, words: wordObjects, pattern };
                });

                setExamples(processed);
                setGrammarPattern(processed[0].pattern);
                
                startPractice(processed);
            };
            
            const startPractice = (examplesToPractice) => {
                setCorrectAnswers(0);
                setCurrentExampleIndex(0);
                prepareExercise(examplesToPractice[0]);
                setAppState('practice');
            };
            
            const prepareExercise = (example) => {
                setUserAnswer(Array(example.words.length).fill(null));
                setSlotStatus(Array(example.words.length).fill('neutral'));
                setAvailableWords([...example.words].sort(() => Math.random() - 0.5));
                setFeedback(null);
            };

            const checkAnswer = () => {
                if (userAnswer.includes(null)) {
                    setFeedback({ correct: false, message: "Por favor, completa todos los espacios." });
                    return;
                }
                const currentExample = examples[currentExampleIndex];
                const isCorrect = userAnswer.every((word, index) => word.text === currentExample.words[index].text);
                const newSlotStatus = userAnswer.map((word, index) => 
                    word.text === currentExample.words[index].text ? 'correct' : 'incorrect'
                );
                setSlotStatus(newSlotStatus);

                if (isCorrect) {
                    setCorrectAnswers(prev => prev + 1);
                    setFeedback({ correct: true, message: "¡Correcto! Excelente trabajo." });
                } else {
                    setFeedback({ correct: false, message: "Algunas palabras no están en la posición correcta. Inténtalo de nuevo." });
                }
            };

            const nextExample = () => {
                const nextIndex = currentExampleIndex + 1;
                if (nextIndex < examples.length) {
                    setCurrentExampleIndex(nextIndex);
                    prepareExercise(examples[nextIndex]);
                } else {
                    setAppState('results');
                }
            };

            const resetCurrentExercise = () => {
                prepareExercise(examples[currentExampleIndex]);
            };
            
            const resetEverything = () => {
                setFormState({ grammarTitle: '', examplesText: '' });
                setAppState('input');
            };

            const handleDragStart = (e, word, fromIndex) => {
                setDraggingItem({ word, fromIndex });
                e.dataTransfer.effectAllowed = 'move';
            };
            
            const handleDragOver = (e) => e.preventDefault();
            
            const handleDrop = (e, toSlotIndex) => {
                e.preventDefault();
                if (!draggingItem || userAnswer[toSlotIndex] !== null || feedback) return;

                const newAnswer = [...userAnswer];
                newAnswer[toSlotIndex] = draggingItem.word;
                setUserAnswer(newAnswer);

                const newAvailable = availableWords.filter((_, index) => index !== draggingItem.fromIndex);
                setAvailableWords(newAvailable);
                
                setDraggingItem(null);
            };

            const removeFromSlot = (slotIndex) => {
                if (feedback) return;
                const wordToRemove = userAnswer[slotIndex];
                if (!wordToRemove) return;
                setAvailableWords(prev => [...prev, wordToRemove]);
                const newAnswer = [...userAnswer];
                newAnswer[slotIndex] = null;
                setUserAnswer(newAnswer);
            };

            // Touch event handlers for mobile
            const handleTouchStart = (e, word, fromIndex) => {
                if (feedback) return;
                e.preventDefault();
                const touch = e.touches[0];
                setDraggingItem({ word, fromIndex });
                setTouchState({
                    isDragging: true,
                    draggedElement: e.target,
                    startPosition: { x: touch.clientX, y: touch.clientY },
                    currentPosition: { x: touch.clientX, y: touch.clientY }
                });
                
                // Add visual feedback
                e.target.style.opacity = '0.7';
                e.target.style.transform = 'scale(1.1)';
            };

            const handleTouchMove = (e) => {
                if (!touchState.isDragging) return;
                e.preventDefault();
                const touch = e.touches[0];
                setTouchState(prev => ({
                    ...prev,
                    currentPosition: { x: touch.clientX, y: touch.clientY }
                }));
            };

            const handleTouchEnd = (e) => {
                if (!touchState.isDragging || !draggingItem) return;
                e.preventDefault();
                
                // Find the element under the finger
                const touch = e.changedTouches[0];
                const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                
                // Reset visual feedback
                if (touchState.draggedElement) {
                    touchState.draggedElement.style.opacity = '1';
                    touchState.draggedElement.style.transform = 'scale(1)';
                }
                
                // Check if dropped on a slot
                let slotElement = elementBelow;
                let slotIndex = -1;
                
                // Find the slot container
                while (slotElement && !slotElement.hasAttribute('data-slot-index')) {
                    slotElement = slotElement.parentElement;
                }
                
                if (slotElement) {
                    slotIndex = parseInt(slotElement.getAttribute('data-slot-index'));
                    
                    // Check if slot is empty
                    if (slotIndex >= 0 && slotIndex < userAnswer.length && userAnswer[slotIndex] === null) {
                        const newAnswer = [...userAnswer];
                        newAnswer[slotIndex] = draggingItem.word;
                        setUserAnswer(newAnswer);

                        const newAvailable = availableWords.filter((_, index) => index !== draggingItem.fromIndex);
                        setAvailableWords(newAvailable);
                    }
                }
                
                // Reset states
                setTouchState({
                    isDragging: false,
                    draggedElement: null,
                    startPosition: { x: 0, y: 0 },
                    currentPosition: { x: 0, y: 0 }
                });
                setDraggingItem(null);
            };

            const renderContent = () => {
                switch (appState) {
                    case 'input':
                        return <InputScreen 
                            {...formState}
                            onInputChange={handleInputChange}
                            processExamples={processExamples}
                        />;
                    case 'practice':
                        const practiceData = {
                            grammarTitle: formState.grammarTitle,
                            currentExampleIndex,
                            examplesLength: examples.length,
                            grammarPattern,
                            userAnswer,
                            availableWords,
                            feedback,
                            slotStatus,
                        };
                        const handlers = {
                            handleDragStart, handleDragOver, handleDrop, removeFromSlot, 
                            handleTouchStart, handleTouchMove, handleTouchEnd,
                            resetCurrentExercise, backToInput: () => setAppState('input'),
                            checkAnswer, nextExample
                        };
                        return <PracticeScreen practiceData={practiceData} handlers={handlers} />;
                    case 'results':
                        const resultsData = { grammarTitle: formState.grammarTitle, correctAnswers, examples };
                        const resultHandlers = { resetEverything, startPractice };
                        return <ResultsScreen resultsData={resultsData} handlers={resultHandlers} />;
                    default:
                        return <div>Error: Estado desconocido</div>;
                }
            };

            return (
                <div className="min-h-screen p-4 sm:p-6 md:p-8">
                    <div className="max-w-4xl mx-auto">
                        <header className="glass-header text-white p-6 shadow-lg mb-6">
                            <h1 className="text-3xl font-bold" style={{color: '#FFD700', textShadow: '0 4px 8px rgba(0, 0, 0, 0.3)'}}>Gramática</h1>
                            <p className="mt-2 opacity-90" style={{color: '#E0E0E0'}}> </p>
                        </header>
                        <main>
                            {renderContent()}
                        </main>
                    </div>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
    
    <script>
        // Script para generar hojas cayendo
        function createFallingLeaf() {
            const leaf = document.createElement('div');
            leaf.className = 'leaf';
            leaf.innerHTML = Math.random() > 0.5 ? '🍂' : '🍃';
            
            // Posición aleatoria en el ancho de la pantalla
            leaf.style.left = Math.random() * 100 + '%';
            
            // Retraso aleatorio para cada hoja
            leaf.style.animationDelay = Math.random() * 5 + 's';
            
            // Añadir ligera variación en la duración
            const baseDuration = parseFloat(getComputedStyle(leaf).animationDuration);
            leaf.style.animationDuration = (baseDuration + (Math.random() - 0.5) * 4) + 's';
            
            document.getElementById('falling-leaves').appendChild(leaf);
            
            // Remover la hoja después de que termine la animación
            setTimeout(() => {
                if (leaf.parentNode) {
                    leaf.parentNode.removeChild(leaf);
                }
            }, 20000);
        }
        
        // Crear hojas cayendo cada cierto tiempo
        setInterval(createFallingLeaf, 1000);
        
        // Crear algunas hojas iniciales
        for (let i = 0; i < 8; i++) {
            setTimeout(createFallingLeaf, i * 600);
        }
    </script>
</body>
</html>